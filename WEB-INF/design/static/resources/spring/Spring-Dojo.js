/*
 * Copyright 2004-2008 the original author or authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
dojo.declare("Spring.DefaultEquals",null,{equals:function(_1){if(_1.declaredClass&&_1.declaredClass==this.declaredClass){return true;}else{return false;}}});dojo.declare("Spring.ElementDecoration",[Spring.AbstractElementDecoration,Spring.DefaultEquals],{constructor:function(_2){this.widgetAttrs={};this.copyFields=new Array("name","value","type","checked","selected","readOnly","disabled","alt","maxLength","class","title");dojo.mixin(this,_2);this.element=dojo.byId(this.elementId);this.elementId=dojo.isString(this.elementId)?this.elementId:this.elementId.id;if(this.widgetModule==""){this.widgetModule=this.widgetType;}dojo.require(this.widgetModule);},apply:function(){if(dijit.byId(this.elementId)){dijit.byId(this.elementId).destroyRecursive(false);}if(!this.element){console.error("Could not apply "+this.widgetType+" decoration.  Element with id '"+this.elementId+"' not found in the DOM.");}else{var _3=this.widgetAttrs["datePattern"];if(_3&&this.widgetType=="dijit.form.DateTextBox"){if(!this.widgetAttrs["value"]){this.widgetAttrs["value"]=dojo.date.locale.parse(this.element.value,{selector:"date",datePattern:_3});}if(!this.widgetAttrs["serialize"]){this.widgetAttrs["serialize"]=function(d,_4){return dojo.date.locale.format(d,{selector:"date",datePattern:_3});};}if(!this.widgetAttrs["constraints"]){this.widgetAttrs["constraints"]={};}if(!this.widgetAttrs["constraints"].datePattern){this.widgetAttrs["constraints"].datePattern=_3;}}for(var _5 in this.copyFields){_5=this.copyFields[_5];if(!this.widgetAttrs[_5]&&this.element[_5]&&(typeof this.element[_5]!="number"||(typeof this.element[_5]=="number"&&this.element[_5]>=0))){this.widgetAttrs[_5]=this.element[_5];}}if(this.element["style"]&&this.element["style"].cssText){this.widgetAttrs["style"]=this.element["style"].cssText;}var _6=dojo.eval(this.widgetType);this.widget=new _6(this.widgetAttrs,this.element);this.widget.startup();}return this;},validate:function(){if(!this.widget.isValid){return true;}var _7=this.widget.isValid(false);if(!_7){this.widget.state="Error";this.widget._setStateClass();}return _7;}});dojo.declare("Spring.ValidateAllDecoration",[Spring.AbstractValidateAllDecoration,Spring.DefaultEquals],{constructor:function(_8){this.originalHandler=null;this.connection=null;dojo.mixin(this,_8);},apply:function(){var _9=dojo.byId(this.elementId);if(!_9){console.error("Could not apply ValidateAll decoration.  Element with id '"+this.elementId+"' not found in the DOM.");}else{this.originalHandler=_9[this.event];var _a=this;_9[this.event]=function(_b){_a.handleEvent(_b,_a);};}return this;},cleanup:function(){dojo.disconnect(this.connection);},handleEvent:function(_c,_d){if(!Spring.validateAll()){dojo.publish(this.elementId+"/validation",[false]);dojo.stopEvent(_c);}else{dojo.publish(this.elementId+"/validation",[true]);if(dojo.isFunction(_d.originalHandler)){var _e=_d.originalHandler(_c);if(_e==false){dojo.stopEvent(_c);}}}}});dojo.declare("Spring.AjaxEventDecoration",[Spring.AbstractAjaxEventDecoration,Spring.DefaultEquals],{constructor:function(_f){this.validationSubscription=null;this.connection=null;this.allowed=true;dojo.mixin(this,_f);},apply:function(){var _10=dijit.byId(this.elementId)?dijit.byId(this.elementId):dojo.byId(this.elementId);if(!_10){console.error("Could not apply AjaxEvent decoration.  Element with id '"+this.elementId+"' not found in the DOM.");}else{this.validationSubscription=dojo.subscribe(this.elementId+"/validation",this,"_handleValidation");this.connection=dojo.connect(_10,this.event,this,"submit");}return this;},cleanup:function(){dojo.unsubscribe(this.validationSubscription);dojo.disconnect(this.connection);},submit:function(_11){if(this.sourceId==""){this.sourceId=this.elementId;}if(this.formId==""){Spring.remoting.getLinkedResource(this.sourceId,this.params,this.popup);}else{if(this.allowed){Spring.remoting.submitForm(this.sourceId,this.formId,this.params);}}dojo.stopEvent(_11);},_handleValidation:function(_12){if(!_12){this.allowed=false;}else{this.allowed=true;}}});dojo.declare("Spring.RemotingHandler",Spring.AbstractRemotingHandler,{constructor:function(){},submitForm:function(_13,_14,_15){var _16=new Object();for(var key in _15){_16[key]=_15[key];}var _17=dojo.byId(_13);if(_17!=null){if(_17.value!=undefined&&_17.type&&("button,submit,reset").indexOf(_17.type)<0){_16[_13]=_17.value;}else{if(_17.name!=undefined){_16[_17.name]=_17.name;}else{_16[_13]=_13;}}}if(!_16["ajaxSource"]){_16["ajaxSource"]=_13;}var _18=dojo.byId(_14);var _19=dojo.string.trim(_18.method);_19=_19.length>0?_19.toUpperCase():"GET";dojo.xhr(_19,{content:_16,form:_14,handleAs:"text",headers:{"Accept":"text/html;type=ajax"},load:this.handleResponse,error:this.handleError},_19=="POST"?true:false);},getLinkedResource:function(_1a,_1b,_1c){this.getResource(dojo.byId(_1a).href,_1b,_1c);},getResource:function(_1d,_1e,_1f){dojo.xhrGet({url:_1d,content:_1e,handleAs:"text",headers:{"Accept":"text/html;type=ajax"},load:this.handleResponse,error:this.handleError,modal:_1f});},handleResponse:function(_20,_21){var _22=_21.xhr.getResponseHeader("Spring-Redirect-URL");var _23=_21.xhr.getResponseHeader("Spring-Modal-View");var _24=((dojo.isString(_23)&&_23.length>0)||_21.args.modal);if(dojo.isString(_22)&&_22.length>0){if(_24){Spring.remoting._renderURLToModalDialog(_22);return _20;}else{if(_22.indexOf("/")>=0){window.location=window.location.protocol+"//"+window.location.host+_22;}else{var _25=window.location.protocol+"//"+window.location.host+window.location.pathname;var _26=_25.lastIndexOf("/");_25=_25.substr(0,_26+1)+_22;if(_25==window.location){Spring.remoting.getResource(_25,_21.args.content,false);}else{window.location=_25;}}return _20;}}else{if((dojo.string.trim(_20).length==0)&&(_21.xhr.status!=204)&&(_21.xhr.status!=205)){if(Spring.debug){Spring.remoting.showError("Received empty response with no Spring redirect headers. If this is intentional set the response status code to 204 or 205.");}}}var _27="(?:<script(.|[\n|\r])*?>)((\n|\r|.)*?)(?:</script>)";var _28=[];var _29=new RegExp(_27,"img");var _2a=new RegExp(_27,"im");var _2b=_20.match(_29);if(_2b!=null){for(var i=0;i<_2b.length;i++){var _2c=(_2b[i].match(_2a)||["","",""])[2];_2c=_2c.replace(/<!--/mg,"").replace(/\/\/-->/mg,"").replace(/<!\[CDATA\[(\/\/>)*/mg,"").replace(/(<!)*\]\]>/mg,"");_28.push(_2c);}}_20=_20.replace(_29,"<script> // Original script removed to avoid re-execution </script>");if(_24){Spring.remoting._renderResponseToModalDialog(_20);}else{var _2d=dojo.doc.createElement("span");_2d.id="ajaxResponse";_2d.style.display="none";document.body.appendChild(_2d);_2d.innerHTML=_20;var _2e=new dojo.NodeList(_2d);var _2f=_2e.query(">").orphan();_2e.orphan();_2f.forEach(function(_30){if(_30.id!=null&&_30.id!=""){var _31=dijit.byId(_30.id)?dijit.byId(_30.id).domNode:dojo.byId(_30.id);if(!_31){console.error("An existing DOM elment with id '"+_30.id+"' could not be found for replacement.");}else{_31.parentNode.replaceChild(_30,_31);}}});}dojo.forEach(_28,function(_32){dojo.eval(_32);});return _20;},handleError:function(_33,_34){dojo.require("dijit.Dialog");console.error("HTTP status code: ",_34.xhr.status);if(Spring.debug&&_34.xhr.status!=200){var _35=new dijit.Dialog({title:"Ajax Request Error"});dojo.connect(_35,"hide",_35,function(){this.destroyRecursive(false);});_35.domNode.style.overflow="auto";_35.setContent(_34.xhr.responseText);_35.show();}return _33;},showError:function(_36){dojo.require("dijit.Dialog");var _37=new dijit.Dialog({title:"Error Message"});dojo.connect(_37,"hide",_37,function(){this.destroyRecursive(false);});_37.domNode.style.width="500px";_37.setContent(_36);_37.show();},_renderURLToModalDialog:function(url){Spring.remoting.getResource(url,{},true);},_renderResponseToModalDialog:function(_38){dojo.require("dijit.Dialog");var _39=new dijit.Dialog({});_39.setContent(_38);dojo.connect(_39,"hide",_39,function(){this.destroyRecursive(false);});_39.show();}});dojo.declare("Spring.CommandLinkDecoration",[Spring.AbstractCommandLinkDecoration,Spring.DefaultEquals],{constructor:function(_3a){dojo.mixin(this,_3a);},apply:function(){var _3b=dojo.byId(this.elementId);if(!dojo.hasClass(_3b,"progressiveLink")){var _3c=new dojo.NodeList(_3b);_3c.addContent(this.linkHtml,"after").orphan("*");_3b=dojo.byId(this.elementId);}_3b.submitFormFromLink=this.submitFormFromLink;return this;},submitFormFromLink:function(_3d,_3e,_3f){var _40=[];var _41=dojo.byId(_3d);var _42=document.createElement("input");_42.name=_3e;_42.value="submitted";_40.push(_42);dojo.forEach(_3f,function(_43){var _44=document.createElement("input");_44.name=_43.name;_44.value=_43.value;_40.push(_44);});dojo.forEach(_40,function(_45){dojo.addClass(_45,"SpringLinkInput");dojo.place(_45,_41,"last");});if((_41.onsubmit?!_41.onsubmit():false)||!_41.submit()){dojo.forEach(_40,function(_46){_46.parentNode.removeChild(_46);});}}});dojo.addOnLoad(Spring.initialize);